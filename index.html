<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookNook ‚Äî Premium Digital Bookstore</title>

  <!-- Prevent favicon 404 spam -->
  <link rel="icon" href="data:," />

  <!-- Premium Font Imports -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&family=DM+Sans:wght@400;500;600;700&family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Your stylesheet -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Razorpay SDK -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- Safe fallback so sections can be hidden even if CSS/JS race -->
  <style>
    .hidden {
      display: none !important;
    }
  </style>

  <!-- Backend base URL (adjust port if needed) -->
  <script>
    // Use your actual Render backend URL here
    window.API_BASE_URL = "https://project-backend-zt54.onrender.com/api";
    // For local development, uncomment the line below:
    // window.API_BASE_URL = "http://127.0.0.1:5000/api";
  </script>
</head>

<body>
  <header>
    <div class="nav">
      <div class="brand">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 19.5C4 18.837 4.26339 18.2011 4.73223 17.7322C5.20107 17.2634 5.83696 17 6.5 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6.5 2H20V22H6.5C5.83696 22 5.20107 21.7366 4.73223 21.2678C4.26339 20.7989 4 20.163 4 19.5V4.5C4 3.83696 4.26339 3.20107 4.73223 2.73223C5.20107 2.26339 5.83696 2 6.5 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span class="brand-text">BookNook</span>
      </div>
      <button class="navbtn" data-nav="home">Home</button>
      <button class="navbtn" data-nav="catalog">Catalog</button>
      <button class="navbtn" data-nav="orders">Orders</button>
      <button class="navbtn" data-nav="profile">Profile</button>
      <div class="spacer"></div>
      <button id="btnNotifications" class="btn ghost small" title="Gift Notifications">
        üîî <span id="navNotificationBadge" class="notification-count hidden">0</span>
      </button>
      <button id="btnReset" class="btn ghost small">Reset Demo</button>
      <button id="btnAdmin" class="btn ghost small">Admin Login</button>
      <span id="navAvatar" class="avatar-sm hidden"></span>
      <span id="navUser" class="tag hidden"></span>
      <button id="btnLogin" class="btn">Login</button>
      <button id="btnLogout" class="btn bad hidden">Logout</button>
      <button id="btnCart" class="btn primary">Cart <span id="cartCount" class="kbd">0</span></button>
    </div>
  </header>

  <main>
    <section id="loginSection" class="hidden grid">
      <div class="panel">
        <h1>Welcome Back</h1>
        <p class="subtitle">Sign in to continue your reading journey</p>
        <form id="formLogin" class="grid" autocomplete="off">
          <div><label>Email</label><input type="email" name="email" required /></div>
          <div><label>Password</label><input type="password" name="password" required /></div>
          <div class="row">
            <button class="btn" type="submit">Login</button>
            <button id="switchToRegister" type="button" class="btn ghost">Create account</button>
          </div>
        </form>
        <div class="divider"></div>
        <button type="button" class="google-signin-btn">
          <span class="google-icon"></span>
          Sign in with Google
        </button>

        <p class="small muted">Tip: Create an account if you don't have one.</p>
      </div>
    </section>

    <section id="registerSection" class="hidden grid">
      <div class="panel">
        <h1>Join BookNook</h1>
        <p class="subtitle">Create your account and discover your next great read</p>
        <form id="formRegister" class="grid" autocomplete="off">
          <div class="row">
            <div><label>Full name</label><input name="name" required /></div>
            <div><label>Email</label><input type="email" name="email" required /></div>
          </div>
          <div class="row">
            <div><label>Password</label><input type="password" name="password" minlength="6" required /></div>
            <div><label>Phone</label><input name="phone" /></div>
          </div>
          <div><label>About you</label><textarea name="bio" rows="2"></textarea></div>
          <div class="row">
            <button class="btn primary" type="submit">Register</button>
            <button id="switchToLogin" type="button" class="btn ghost">Back to login</button>
          </div>
        </form>
        <div class="divider"></div>
        <button type="button" class="google-signin-btn">
          <span class="google-icon"></span>
          Sign in with Google
        </button>

      </div>
    </section>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Admin Login</h2>
          <span id="closeAdminModal" class="close">&times;</span>
        </div>
        <form id="formAdminLogin" class="grid">
          <div>
            <label>Admin Email</label>
            <input type="email" id="adminEmail" name="email" required placeholder="Enter admin email" />
          </div>
          <div>
            <label>Admin Password</label>
            <input type="password" id="adminPassword" name="password" required placeholder="Enter admin password" />
          </div>
          <div class="row">
            <button type="submit" class="btn primary">Login as Admin</button>
            <button type="button" id="cancelAdminLogin" class="btn ghost">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Admin Panel (hidden by default) -->
    <section id="adminPanel" class="hidden grid two">
      <div class="panel">
        <div class="admin-header">
          <h1>üìä Admin Dashboard</h1>
          <div class="admin-welcome">
            <span class="admin-status">‚óè Online</span>
            <span id="adminWelcomeName">Welcome, Admin</span>
          </div>
        </div>

        <!-- Admin tabs -->
        <div class="pillbar admin-nav" style="margin-bottom:20px">
          <button id="adminViewDashboard" class="btn primary">üìä Overview</button>
          <button id="adminViewOrders" class="btn">üì¶ Orders</button>
          <button id="adminViewUsers" class="btn">üë• Users</button>
          <button id="adminViewBooks" class="btn">üìö Books</button>
          <button id="adminViewGoogleBooks" class="btn">üîç Import Books</button>
          <button id="adminViewAnalytics" class="btn">üìà Analytics</button>
          <button id="adminLogout" class="btn bad">üö™ Logout</button>
        </div>

        <!-- Search bar for admin content -->
        <div id="adminSearchBar" class="searchbar hidden" style="margin-bottom:16px">
          <input type="text" id="adminSearch" placeholder="Search..." />
          <button class="btn ghost">üîç</button>
        </div>

        <!-- Content rendered by JS -->
        <div id="adminMain" style="margin-top:12px"></div>
      </div>

      <div class="panel">
        <h2>üìù Add / Edit Book</h2>
        <form id="adminBookForm" class="grid">
          <div><label>Title</label><input name="title" required /></div>
          <div><label>Author</label><input name="author" required /></div>
          <div class="row3">
            <div><label>Price (‚Çπ)</label><input name="price" inputmode="decimal" placeholder="0.00" /></div>
            <div><label>Stock</label><input name="stock" inputmode="numeric" placeholder="0" /></div>
            <div><label>Category</label><input name="category" placeholder="Fiction, Science, etc." /></div>
          </div>
          <div class="row">
            <div>
              <label>Book Cover Image</label>
              <input name="cover_image" type="file" accept="image/*" />
              <small class="muted">Upload JPG, PNG, or WebP image</small>
            </div>
            <div>
              <label>Book Content (PDF)</label>
              <input name="book_content" type="file" accept=".pdf,.epub" />
              <small class="muted">Upload PDF or EPUB file</small>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Page Count</label>
              <input name="page_count" inputmode="numeric" placeholder="0" />
            </div>
            <div>
              <label>Book Sample (Optional)</label>
              <input name="book_sample" type="file" accept=".pdf,.epub" />
              <small class="muted">Upload sample pages for preview</small>
            </div>
          </div>
          <div><label>Book Description</label><textarea name="description" rows="4" placeholder="Brief synopsis..."></textarea></div>
          <input type="hidden" name="book_id" />
          <div class="row">
            <button class="btn primary" type="submit">üíæ Save book</button>
            <button id="clearAdminBookForm" type="button" class="btn ghost">Clear form</button>
          </div>
        </form>
      </div>
    </section>

    <section id="homeSection" class="grid">
      <div class="panel">
        <div id="homeMain">
          <h1 class="welcome-title">Discover Your Next Great Read</h1>
          <p class="welcome-subtitle">Curated collection of timeless classics and modern bestsellers</p>
        </div>
      </div>
    </section>

    <section id="catalogSection" class="hidden grid">
      <div class="panel">
        <div class="panel-header">
          <h1>üìö Book Catalog</h1>
          <div class="catalog-controls">
            <div class="searchbar">
              <input type="text" id="searchBox" placeholder="Search books..." />
              <button class="btn ghost">üîç</button>
            </div>
            <div class="filters">
              <select id="categoryFilter" class="filter-select">
                <option value="">All Categories</option>
              </select>
              <select id="sortBy" class="filter-select">
                <option value="title">Sort by Title</option>
                <option value="price_asc">Price: Low to High</option>
                <option value="price_desc">Price: High to Low</option>
              </select>
            </div>
          </div>
        </div>
        <div id="catalogBooks" class="book-grid"></div>
      </div>
    </section>

    <section id="checkoutSection" class="hidden grid two">
      <div class="panel">
        <h1>Checkout</h1>
        <div id="checkoutItems"></div>
        <div class="hr"></div>
        <div class="row">
          <div>
            <div class="label">Subtotal</div>
            <div id="checkoutSubtotal" class="price">‚Çπ0.00</div>
          </div>
          <div>
            <div class="label">Shipping</div>
            <div id="checkoutShipping" class="price">‚Çπ0.00</div>
          </div>
        </div>
        <div class="hr"></div>
        <div class="row">
          <div>
            <h2>Total</h2>
          </div>
          <div class="right">
            <h2 id="checkoutTotal" class="price">‚Çπ0.00</h2>
          </div>
        </div>
      </div>
      <div class="panel">
        <h2>Shipping address</h2>
        <form id="formCheckout" class="grid">
          <div><label>Select address</label><select id="checkoutAddress" required>
              <option value="">‚Äî Choose address ‚Äî</option>
            </select></div>
          <div><label>Payment method</label><select id="checkoutPaymentMethod" required>
              <option value="razorpay">Razorpay</option>
              <option value="cod">Cash on delivery</option>
            </select></div>
          <button class="btn primary" type="submit">Place order</button>
        </form>
      </div>
    </section>

    <section id="ordersSection" class="hidden grid">
      <div class="panel">
        <h1>Your Orders</h1>
        <div id="ordersList"></div>
      </div>
    </section>

    <section id="profileSection" class="hidden grid two">
      <div class="panel">
        <h1>Your Profile</h1>
        <div id="profileMain">
          <div id="profileAvatar" class="avatar-lg"></div>
          <h2 id="profileName"></h2>
          <p id="profileEmail" class="muted"></p>
          <div class="hr"></div>
          <div class="grid" style="gap:8px">
            <div class="row">
              <div class="label">Phone</div>
              <div id="profilePhone">‚Äî</div>
            </div>
            <div class="row">
              <div class="label">Bio</div>
              <div id="profileBio">‚Äî</div>
            </div>
            <div class="row">
              <div class="label">Member since</div>
              <div id="profileMemberSince">‚Äî</div>
            </div>
            <div class="row">
              <div class="label">Total orders</div>
              <div id="profileTotalOrders">0</div>
            </div>
          </div>
          <div class="hr"></div>
          <button id="btnEditProfile" class="btn">Edit profile</button>
          <div id="profileEditForm" class="hidden grid" style="margin-top:16px">
            <form id="formEditProfile" class="grid">
              <div><label>Full name</label><input id="editName" required /></div>
              <div><label>Phone</label><input id="editPhone" /></div>
              <div><label>Bio</label><textarea id="editBio" rows="3"></textarea></div>
              <div class="row">
                <button class="btn primary" type="submit">Save changes</button>
                <button id="btnCancelEdit" type="button" class="btn ghost">Cancel</button>
              </div>
            </form>
          </div>
          <div id="changePassword" class="grid" style="margin-top:16px">
            <div class="row">
              <h3>Change password</h3>
              <div class="right"><button id="cpSave" class="btn">Update password</button></div>
            </div>
          </div>
        </div>
      </div>
      <div class="panel">
        <h1>Shipping Addresses</h1>
        <h2>Saved Addresses</h2>
        <div id="addrList" class="grid"></div>
        <form id="formAddress" class="grid" style="margin-top:8px">
          <div class="row">
            <div><label>Label</label><input name="label" placeholder="Home / Office" required /></div>
            <div><label>Recipient</label><input name="recipient" required /></div>
          </div>
          <div><label>Street</label><input name="street" required /></div>
          <div class="row3">
            <div><label>City</label><input name="city" required /></div>
            <div><label>State</label><input name="state" required /></div>
            <div><label>PIN</label><input name="zip" required /></div>
          </div>
          <button class="btn primary" type="submit">Add address</button>
        </form>
      </div>
    </section>
  </main>

  <!-- Cart drawer -->
  <div id="cartDrawer" class="drawer" role="dialog" aria-modal="true">
    <header>
      <div class="pillbar" style="justify-content:space-between;align-items:center">
        <h2 style="margin:0">Your Cart</h2>
        <button id="cartClose" class="btn bad small">Close</button>
      </div>
    </header>
    <div class="body">
      <div id="cartItems"></div>
    </div>
    <div class="foot">
      <div class="row">
        <div><span class="muted">Subtotal</span>
          <div id="cartSubtotal" class="price">‚Çπ0.00</div>
        </div>
        <div class="right">
          <button id="cartToCheckout" class="btn primary">Go to checkout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reader Modal -->
  <div id="readerModal" class="modal" role="dialog" aria-modal="true">
    <div class="content panel" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <h2 id="readerTitle">Book Reader</h2>
      <div class="reader-page">
        <div id="readerBody">Loading...</div>
      </div>
      <div class="hr"></div>
      <div class="right"><button id="readerClose" class="btn bad">Close</button></div>
    </div>
  </div>

  <!-- Notification Dropdown Modal -->
  <div id="notificationModal" class="modal hidden">
    <div class="modal-content notification-dropdown">
      <div class="modal-header">
        <h3>Gift Notifications</h3>
        <button id="notificationClose" class="btn ghost small">√ó</button>
      </div>
      <div id="notificationList" class="notification-list">
        <p class="muted">Loading notifications...</p>
      </div>
    </div>
  </div>

  <div id="toast"></div>

  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCvMzzv81adkAQwBwDXYPUUO1yu3QrKy34",
      authDomain: "booknook-3c7c4.firebaseapp.com",
      projectId: "booknook-3c7c4",
      storageBucket: "booknook-3c7c4.appspot.com",
      messagingSenderId: "877893321467",
      appId: "1:877893321467:web:c5c631d70a7b980850665e",
      measurementId: "G-8NFBLJNF8P"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- AI Chat Assistant Widget -->
  <div id="aiChatWidget" class="ai-chat-widget">
    <button id="aiChatToggle" class="ai-chat-toggle" title="AI Book Assistant">
      ü§ñ
    </button>
    <div id="aiChatWindow" class="ai-chat-window hidden">
      <div class="ai-chat-header">
        <div class="ai-chat-title">
          <span class="ai-avatar">ü§ñ</span>
          <div>
            <strong>BookNook AI</strong>
            <span class="ai-status">‚óè Online</span>
          </div>
        </div>
        <button id="aiChatClose" class="ai-chat-close">√ó</button>
      </div>
      <div id="aiChatMessages" class="ai-chat-messages">
        <div class="ai-message bot">
          <div class="ai-message-content">
            Hi! I'm your AI book assistant. Tell me what kind of book you're looking for!
            <br><br>
            Try: <em>"I want a short thriller under ‚Çπ300"</em> or <em>"Show me inspiring business books"</em>
          </div>
        </div>
      </div>
      <div class="ai-chat-input">
        <input type="text" id="aiChatInput" placeholder="Describe what you want to read..." />
        <button id="aiChatSend" class="btn primary">Send</button>
      </div>
    </div>
  </div>

  <!-- Book Search by Image Widget -->
  <div id="bookSearchWidget" class="book-search-widget">
    <button id="bookSearchToggle" class="book-search-toggle" title="Find Book by Image">
      üì∏
    </button>
    <div id="bookSearchWindow" class="book-search-window hidden">
      <div class="book-search-header">
        <div class="book-search-title">
          <span class="search-avatar">üîç</span>
          <div>
            <strong>Book Finder AI</strong>
            <span class="ai-status">‚óè 5 Agents Ready</span>
          </div>
        </div>
        <button id="bookSearchClose" class="book-search-close">√ó</button>
      </div>
      <div class="book-search-content">
        <div class="book-search-upload-area" id="bookSearchDropZone">
          <div class="upload-icon">üìÑ</div>
          <p><strong>Upload a book page</strong></p>
          <p class="small muted">Drag & drop or click to upload</p>
          <p class="small muted">Our AI will identify which book it's from!</p>
          <input type="file" id="bookSearchInput" accept="image/*" hidden />
        </div>
        <div id="bookSearchPreview" class="book-search-preview hidden">
          <img id="bookSearchImage" src="" alt="Uploaded image" />
          <button id="bookSearchClear" class="btn ghost small">‚úï Clear</button>
        </div>
        <button id="bookSearchSubmit" class="btn primary book-search-submit hidden">
          üîç Find This Book
        </button>
        <div id="bookSearchLoading" class="book-search-loading hidden">
          <div class="agent-progress">
            <div class="agent-step" data-agent="ocr">üñºÔ∏è OCR Agent extracting text...</div>
            <div class="agent-step" data-agent="identification">üìö Book Identifier Agent analyzing...</div>
            <div class="agent-step" data-agent="database">üóÑÔ∏è Database Agent searching store...</div>
            <div class="agent-step" data-agent="response">ü§ñ Response Agent generating result...</div>
          </div>
        </div>
        <div id="bookSearchResult" class="book-search-result hidden">
          <div class="result-card">
            <div class="result-confidence">
              <span id="resultConfidence">94%</span>
              <span class="confidence-label">Confidence</span>
            </div>
            <div class="result-details">
              <h3 id="resultBookName">Book Name</h3>
              <p id="resultPageNumber" class="result-page">Page 47</p>
              <p id="resultMessage" class="result-message"></p>
            </div>
          </div>
          <div class="result-explanation">
            <h4>ü§ñ How I found it:</h4>
            <p id="resultExplanation"></p>
          </div>
          <div id="resultAgentInsights" class="agent-insights"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts: API first, then your app logic -->
  <script src="api.js"></script>
  <script src="pdf-reader.js"></script>
  <script src="razorpay-integration.js"></script>
  <script src="app.js"></script>
</body>

</html>
