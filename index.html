<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookNook â€” Bookstore</title>

  <!-- Prevent favicon 404 spam -->
  <link rel="icon" href="data:," />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&family=Cormorant+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Your stylesheet -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Razorpay SDK -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- Safe fallback so sections can be hidden even if CSS/JS race -->
  <style>
    .hidden {
      display: none !important;
    }
  </style>

  <!-- Backend base URL (adjust port if needed) -->
  <script>
    // Use your actual Render backend URL here
    window.API_BASE_URL = "https://project-backend-zt54.onrender.com/api";
    // For local development, uncomment the line below:
    // window.API_BASE_URL = "http://127.0.0.1:5000/api";
  </script>
</head>

<body>
  <header>
    <div class="nav">
      <div class="brand">
        <div class="logo"></div> BookNook
      </div>
      <button class="navbtn" data-nav="home">Home</button>
      <button class="navbtn" data-nav="catalog">Catalog</button>
      <button class="navbtn" data-nav="orders">Orders</button>
      <button class="navbtn" data-nav="profile">Profile</button>
      <div class="spacer"></div>
      <button id="btnNotifications" class="btn ghost small" title="Gift Notifications">
        ğŸ”” <span id="navNotificationBadge" class="notification-count hidden">0</span>
      </button>
      <button id="btnReset" class="btn ghost small hidden">Reset Demo</button>
      <span id="navAvatar" class="avatar-sm hidden"></span>
      <span id="navUser" class="tag hidden"></span>
      <button id="btnLogout" class="btn bad hidden">Logout</button>
      <button id="btnCart" class="btn primary">Cart <span id="cartCount" class="kbd">0</span></button>
    </div>
  </header>

  <main>
    <!-- Login Page with Split-Screen Design -->
    <section id="loginSection" class="hidden auth-section">
      <div class="auth-container">
        <!-- Left: Hero Illustration & Benefits -->
        <div class="auth-hero">
          <div class="auth-hero-content">
            <div class="auth-brand">
              <div class="logo"></div>
              <h2>BookNook</h2>
            </div>
            <h1 class="auth-hero-title">Welcome back to your literary escape</h1>
            <p class="auth-hero-subtitle">Access thousands of books, manage your library, and continue your reading journey.</p>
            
            <!-- SVG Illustration: Books and Reading -->
            <div class="auth-illustration">
              <svg viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
                <!-- Book stack illustration -->
                <rect x="80" y="180" width="80" height="100" fill="#d4af37" opacity="0.2" rx="4"/>
                <rect x="90" y="160" width="80" height="100" fill="#8b1538" opacity="0.3" rx="4"/>
                <rect x="100" y="140" width="80" height="100" fill="#d4af37" opacity="0.4" rx="4"/>
                <circle cx="280" cy="100" r="60" fill="#d4af37" opacity="0.1"/>
                <circle cx="280" cy="100" r="45" fill="#d4af37" opacity="0.15"/>
                <!-- Reading person silhouette -->
                <circle cx="280" cy="90" r="20" fill="#8b1538" opacity="0.3"/>
                <rect x="260" y="110" width="40" height="60" fill="#8b1538" opacity="0.3" rx="8"/>
              </svg>
            </div>
            
            <!-- Benefits List -->
            <div class="auth-benefits">
              <div class="auth-benefit">
                <span class="benefit-icon">ğŸ“š</span>
                <div>
                  <h4>Vast Collection</h4>
                  <p>Thousands of books across genres</p>
                </div>
              </div>
              <div class="auth-benefit">
                <span class="benefit-icon">ğŸ</span>
                <div>
                  <h4>Gift Books</h4>
                  <p>Share the joy of reading with friends</p>
                </div>
              </div>
              <div class="auth-benefit">
                <span class="benefit-icon">ğŸ“±</span>
                <div>
                  <h4>Read Anywhere</h4>
                  <p>Access your library on any device</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Right: Login Form -->
        <div class="auth-form-panel">
          <div class="auth-form-content">
            <div class="auth-form-header">
              <h1>Sign in</h1>
              <p class="muted">Welcome back! Please sign in to continue</p>
            </div>
            
            <form id="formLogin" class="auth-form" autocomplete="off">
              <div class="form-group">
                <label>ğŸ“§ Email</label>
                <input type="email" name="email" placeholder="your@email.com" required />
              </div>
              <div class="form-group">
                <label>ğŸ”’ Password</label>
                <input type="password" name="password" placeholder="Enter your password" required />
              </div>
              <button class="btn primary btn-block" type="submit">Sign In</button>
            </form>
            
            <div class="auth-divider">
              <span>or continue with</span>
            </div>
            
            <button type="button" class="google-signin-btn btn-block">
              <span class="google-icon"></span>
              Sign in with Google
            </button>
            
            <div class="auth-footer">
              <p>Don't have an account? <button id="switchToRegister" type="button" class="link-btn">Create one</button></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Register Page with Split-Screen Design -->
    <section id="registerSection" class="hidden auth-section">
      <div class="auth-container">
        <!-- Left: Hero Illustration & Benefits -->
        <div class="auth-hero">
          <div class="auth-hero-content">
            <div class="auth-brand">
              <div class="logo"></div>
              <h2>BookNook</h2>
            </div>
            <h1 class="auth-hero-title">Start your reading adventure today</h1>
            <p class="auth-hero-subtitle">Join thousands of readers discovering their next favorite book.</p>
            
            <!-- SVG Illustration: Open Book -->
            <div class="auth-illustration">
              <svg viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
                <!-- Open book illustration -->
                <path d="M100,150 Q200,120 300,150 L300,230 Q200,200 100,230 Z" fill="#d4af37" opacity="0.2"/>
                <path d="M100,150 Q200,180 300,150 L300,230 Q200,260 100,230 Z" fill="#8b1538" opacity="0.2"/>
                <line x1="200" y1="120" x2="200" y2="260" stroke="#d4af37" stroke-width="2" opacity="0.3"/>
                <!-- Stars for decoration -->
                <circle cx="150" cy="80" r="3" fill="#d4af37" opacity="0.6"/>
                <circle cx="250" cy="70" r="4" fill="#d4af37" opacity="0.5"/>
                <circle cx="320" cy="90" r="3" fill="#d4af37" opacity="0.7"/>
              </svg>
            </div>
            
            <!-- Benefits List -->
            <div class="auth-benefits">
              <div class="auth-benefit">
                <span class="benefit-icon">ğŸ›’</span>
                <div>
                  <h4>Buy or Rent</h4>
                  <p>Flexible options for every reader</p>
                </div>
              </div>
              <div class="auth-benefit">
                <span class="benefit-icon">ğŸ’¾</span>
                <div>
                  <h4>Cloud Library</h4>
                  <p>Your books, always accessible</p>
                </div>
              </div>
              <div class="auth-benefit">
                <span class="benefit-icon">âš¡</span>
                <div>
                  <h4>Instant Access</h4>
                  <p>Start reading immediately</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Right: Register Form -->
        <div class="auth-form-panel">
          <div class="auth-form-content">
            <div class="auth-form-header">
              <h1>Create account</h1>
              <p class="muted">Join BookNook and start your reading journey</p>
            </div>
            
            <form id="formRegister" class="auth-form" autocomplete="off">
              <div class="form-group">
                <label>ğŸ‘¤ Full Name</label>
                <input name="name" placeholder="John Doe" required />
              </div>
              <div class="form-group">
                <label>ğŸ“§ Email</label>
                <input type="email" name="email" placeholder="your@email.com" required />
              </div>
              <div class="form-group">
                <label>ğŸ”’ Password</label>
                <input type="password" name="password" placeholder="Choose a strong password" minlength="6" required />
              </div>
              <div class="form-group">
                <label>ğŸ“± Phone (optional)</label>
                <input name="phone" placeholder="10-digit number" />
              </div>
              <button class="btn primary btn-block" type="submit">Create Account</button>
            </form>
            
            <div class="auth-divider">
              <span>or continue with</span>
            </div>
            
            <button type="button" class="google-signin-btn btn-block">
              <span class="google-icon"></span>
              Sign up with Google
            </button>
            
            <div class="auth-footer">
              <p>Already have an account? <button id="switchToLogin" type="button" class="link-btn">Sign in</button></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Login Modal -->
    <!-- Admin Panel (hidden by default) -->
    <section id="adminPanel" class="hidden">
      <div class="panel">
        <div class="admin-header">
          <h1>ğŸ“Š Admin Dashboard</h1>
          <div class="admin-welcome">
            <span class="admin-status">â— Online</span>
            <span id="adminWelcomeName">Welcome, Admin</span>
          </div>
        </div>

        <!-- Admin tabs -->
        <div class="pillbar admin-nav" style="margin-bottom:20px">
          <button id="adminViewDashboard" class="btn primary">ğŸ“Š Overview</button>
          <button id="adminViewOrders" class="btn">ğŸ“¦ Orders</button>
          <button id="adminViewUsers" class="btn">ğŸ‘¥ Users</button>
          <button id="adminViewBooks" class="btn">ğŸ“š Books</button>
          <button id="adminViewGoogleBooks" class="btn">ğŸ” Import Books</button>
          <button id="adminViewAnalytics" class="btn">ğŸ“ˆ Analytics</button>
          <button id="adminToggleBookForm" class="btn">ğŸ“ Add/Edit Book</button>
          <button id="adminLogout" class="btn bad">ğŸšª Logout</button>
        </div>

        <!-- Search bar for admin content -->
        <div id="adminSearchBar" class="searchbar hidden" style="margin-bottom:16px">
          <input type="text" id="adminSearch" placeholder="Search..." />
          <button class="btn ghost">ğŸ”</button>
        </div>

        <!-- Content rendered by JS -->
        <div id="adminMain" style="margin-top:12px"></div>
      </div>

      <div id="adminBookFormPanel" class="panel hidden" style="margin-top:20px">
        <h2>ğŸ“ Add / Edit Book</h2>
        <form id="adminBookForm" class="grid">
          <div><label>Title</label><input name="title" required /></div>
          <div><label>Author</label><input name="author" required /></div>
          <div class="row3">
            <div><label>Price (â‚¹)</label><input name="price" inputmode="decimal" placeholder="0.00" /></div>
            <div><label>Stock</label><input name="stock" inputmode="numeric" placeholder="0" /></div>
            <div><label>Category</label><input name="category" placeholder="Fiction, Science, etc." /></div>
          </div>
          <div class="row">
            <div>
              <label>Book Cover Image</label>
              <input name="cover_image" type="file" accept="image/*" />
              <small class="muted">Upload JPG, PNG, or WebP image</small>
            </div>
            <div>
              <label>Book Content (PDF)</label>
              <input name="book_content" type="file" accept=".pdf,.epub" />
              <small class="muted">Upload PDF or EPUB file</small>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Page Count</label>
              <input name="page_count" inputmode="numeric" placeholder="0" />
            </div>
            <div>
              <label>Book Sample (Optional)</label>
              <input name="book_sample" type="file" accept=".pdf,.epub" />
              <small class="muted">Upload sample pages for preview</small>
            </div>
          </div>
          <div><label>Description</label><textarea name="description" rows="4"
              placeholder="Enter book description..."></textarea></div>
          <div class="row">
            <button class="btn primary" type="submit">ğŸ’¾ Save Book</button>
            <button id="adminBookCancel" type="button" class="btn ghost">ğŸ”„ Reset</button>
          </div>
        </form>

        <!-- Book Image Preview -->
        <div id="bookImagePreview" class="book-preview hidden">
          <h3>ğŸ“· Preview</h3>
          <img id="previewImg" src="" alt="Book preview"
            style="max-width: 200px; border-radius: 8px; border: 1px solid var(--muted);" />
        </div>
      </div>
    </section>

    <!-- Home -->
    <section id="homeSection" class="hidden grid">
      <!-- Hero Banner -->
      <div class="hero-banner">
        <div class="hero-content">
          <div class="hero-badge">âœ¨ Your Premium Digital Library</div>
          <h1 class="hero-title">Welcome to BookNook</h1>
          <p class="hero-subtitle">Discover, purchase, rent, or gift thousands of books. Your literary journey starts here.</p>
          <div class="hero-features">
            <div class="hero-feature">
              <span class="hero-feature-icon">ğŸ“š</span>
              <div>
                <strong>Buy & Own</strong>
                <p>Keep forever in your library</p>
              </div>
            </div>
            <div class="hero-feature">
              <span class="hero-feature-icon">â±ï¸</span>
              <div>
                <strong>Rent Digitally</strong>
                <p>30 or 60 day access</p>
              </div>
            </div>
            <div class="hero-feature">
              <span class="hero-feature-icon">ğŸ</span>
              <div>
                <strong>Send Gifts</strong>
                <p>Email delivery instantly</p>
              </div>
            </div>
            <div class="hero-feature">
              <span class="hero-feature-icon">ğŸšš</span>
              <div>
                <strong>Quick Delivery</strong>
                <p>Express or standard shipping</p>
              </div>
            </div>
          </div>
          <div class="hero-cta">
            <button class="btn primary large" onclick="document.querySelector('[data-nav=catalog]').click()">Browse Catalog</button>
            <button class="btn ghost large" onclick="document.querySelector('#shoppingAgentInput').focus()">Ask AI Assistant</button>
          </div>
        </div>
        <div class="hero-decoration">
          <!-- SVG book illustration -->
          <svg class="hero-svg" viewBox="0 0 400 500" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="80" y="100" width="240" height="300" rx="8" fill="url(#bookGradient)" stroke="var(--brand-primary)" stroke-width="2"/>
            <rect x="90" y="110" width="220" height="280" rx="4" fill="rgba(17, 24, 39, 0.6)"/>
            <line x1="90" y1="150" x2="280" y2="150" stroke="var(--brand-primary)" stroke-width="1" opacity="0.3"/>
            <line x1="90" y1="180" x2="250" y2="180" stroke="var(--text-muted)" stroke-width="1" opacity="0.2"/>
            <line x1="90" y1="210" x2="270" y2="210" stroke="var(--text-muted)" stroke-width="1" opacity="0.2"/>
            <line x1="90" y1="240" x2="240" y2="240" stroke="var(--text-muted)" stroke-width="1" opacity="0.2"/>
            <circle cx="200" cy="320" r="30" fill="var(--brand-primary)" opacity="0.2"/>
            <path d="M190 320 L198 328 L215 308" stroke="var(--brand-primary)" stroke-width="3" stroke-linecap="round" fill="none"/>
            <defs>
              <linearGradient id="bookGradient" x1="80" y1="100" x2="320" y2="400">
                <stop offset="0%" stop-color="rgba(212, 175, 55, 0.2)"/>
                <stop offset="100%" stop-color="rgba(139, 21, 56, 0.2)"/>
              </linearGradient>
            </defs>
          </svg>
        </div>
      </div>

      <!-- ğŸ¤– AI Shopping Agent -->
      <div class="panel" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid rgba(99, 102, 241, 0.3);">
        <div class="pillbar" style="justify-content:space-between;align-items:center">
          <h2 style="margin:0">ğŸ¤– AI Shopping Assistant</h2>
          <span class="tag small">Try it!</span>
        </div>
        <p class="muted small" style="margin-top:8px">Tell me what you'd like in natural language!</p>
        
        <div id="shoppingAgentSuggestions" class="pillbar" style="margin-bottom:12px;flex-wrap:wrap;gap:6px">
          <button class="btn ghost small shopping-suggestion" data-query="buy Clean Code book">ğŸ’° Buy</button>
          <button class="btn ghost small shopping-suggestion" data-query="buy with express delivery">ğŸš€ Express</button>
          <button class="btn ghost small shopping-suggestion" data-query="rent Atomic Habits for 30 days">ğŸ“… Rent 30d</button>
          <button class="btn ghost small shopping-suggestion" data-query="rent for 60 days">ğŸ“… Rent 60d</button>
          <button class="btn ghost small shopping-suggestion" data-query="gift Sapiens to friend@example.com">ğŸ Gift</button>
        </div>

        <div class="searchbar" style="margin-bottom:12px">
          <input id="shoppingAgentInput" placeholder='Try: "buy Clean Code with express delivery" or "rent for 60 days"' />
          <button id="shoppingAgentBtn" class="btn primary">Ask AI</button>
        </div>

        <div id="shoppingAgentResponse" class="hidden" style="padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;border:1px solid rgba(255,255,255,0.1)">
          <div id="shoppingAgentMessage"></div>
          <div id="shoppingAgentAction" class="hidden" style="margin-top:12px"></div>
        </div>
      </div>

      <div class="panel">
        <h2>Your Library</h2>
        <div id="libraryOwned" class="grid"></div>
        <div class="hr"></div>
        <h2>Rented</h2>
        <div id="libraryRented" class="grid"></div>
        <div class="hr"></div>
        <h2>Gifts <span id="giftNotificationBadge" class="badge hidden">â€¢</span></h2>
        <div id="libraryGifts" class="grid"></div>
        <div class="hr"></div>
        <h2>â¤ï¸ Wishlist <span id="wishlistCount" class="tag small">0</span></h2>
        <div id="libraryWishlist" class="grid"></div>
        <p class="small muted">Purchased books are always available. Rentals are digital access until their due date.
          Gifts are books received from others. Wishlist shows books you saved for later.</p>
      </div>

      <!-- Featured Books Section -->
      <div class="panel featured-section">
        <div class="section-header">
          <div>
            <span class="section-badge">â­ Handpicked</span>
            <h2 class="section-title">Featured This Month</h2>
            <p class="section-subtitle">Curated selection of must-read books</p>
          </div>
          <button class="btn ghost small" onclick="document.querySelector('[data-nav=catalog]').click()">View All â†’</button>
        </div>
        <div id="featuredBookGrid" class="cards"></div>
      </div>

      <div class="panel">
        <div class="section-header">
          <div>
            <span class="section-badge">ğŸ“š Collection</span>
            <h2 class="section-title">Browse Catalog</h2>
            <p class="section-subtitle">Explore our complete library</p>
          </div>
          <button class="btn ghost small" onclick="document.querySelector('[data-nav=catalog]').click()">See More â†’</button>
        </div>
        <div id="homeBookGrid" class="cards"></div>
      </div>
    </section>

    <!-- Catalog -->
    <section id="catalogSection" class="hidden grid">
      <div class="panel">
        <div class="searchbar">
          <input id="searchInput" placeholder="Search by title or author..." />
          <button id="searchBtn" class="btn">Search</button>
          <button id="clearSearchBtn" class="btn ghost">Clear</button>
        </div>
      </div>
      <div id="bookGrid" class="cards"></div>
    </section>

    <!-- Book details modal -->
    <div id="bookModal" class="modal" role="dialog" aria-modal="true">
      <div class="content panel">
        <div id="bmCover" class="cover-lg"></div>
        <div class="pillbar">
          <span id="bmAuthor" class="tag small"></span>
          <span id="bmStock" class="tag small"></span>
          <span id="bmRating" class="tag small rating-tag">â­ -- (0 reviews)</span>
        </div>
        <h1 id="bmTitle"></h1>
        <p id="bmDesc" class="muted"></p>
        <p class="price" id="bmPrice"></p>
        <div class="row">
          <button id="bmBuy" class="btn primary">Buy</button>
          <button id="bmRent" class="btn">Rent</button>
        </div>
        <div style="margin-top:8px">
          <button id="bmGift" class="btn">Gift</button>
          <button id="bmAddCart" class="btn ghost">Add to Cart</button>
        </div>

        <!-- Reviews Section -->
        <div class="hr"></div>
        <div class="reviews-section">
          <h2>â­ Reviews & Ratings</h2>

          <!-- Write Review Form (for verified purchasers) -->
          <div id="writeReviewForm" class="write-review hidden">
            <h3 id="reviewFormTitle">Write a Review</h3>
            <div class="star-rating-input">
              <span class="star-label">Your Rating:</span>
              <div class="stars-input" id="starsInput">
                <span class="star" data-rating="1">â˜†</span>
                <span class="star" data-rating="2">â˜†</span>
                <span class="star" data-rating="3">â˜†</span>
                <span class="star" data-rating="4">â˜†</span>
                <span class="star" data-rating="5">â˜†</span>
              </div>
              <span id="ratingText" class="rating-text"></span>
            </div>
            <textarea id="reviewTextInput" placeholder="Share your thoughts about this book (optional)..."
              rows="3"></textarea>
            <div class="row">
              <button id="submitReviewBtn" class="btn primary">Submit Review</button>
              <button id="deleteReviewBtn" class="btn bad hidden">Delete My Review</button>
            </div>
          </div>
          <p id="loginToReview" class="muted hidden">Please <a href="#" data-login-prompt>login</a> to write a review.
          </p>
          <p id="purchaseToReview" class="muted hidden">ğŸ“š Purchase, rent, or receive this book as a gift to write a
            review.</p>

          <!-- Reviews List -->
          <div id="reviewsList" class="reviews-list">
            <p class="muted">Loading reviews...</p>
          </div>
        </div>

        <div class="hr"></div>
        <div class="right">
          <button id="bmClose" class="btn bad">Close</button>
        </div>
      </div>
    </div>

    <!-- Checkout -->
    <!-- Checkout Page with Step Indicator -->\n    <section id="checkoutSection" class="hidden">
      <div class="checkout-container">
        <!-- Step Progress Indicator -->\n        <div class="checkout-steps">
          <div class="step active">
            <div class="step-icon">ğŸ›’</div>
            <div class="step-label">Cart Items</div>
          </div>
          <div class="step-line"></div>
          <div class="step">
            <div class="step-icon">ğŸ“¦</div>
            <div class="step-label">Delivery</div>
          </div>
          <div class="step-line"></div>
          <div class="step">
            <div class="step-icon">ğŸ’³</div>
            <div class="step-label">Payment</div>
          </div>
        </div>
        
        <div class="checkout-content">
          <!-- Left Column: Checkout Forms -->\n          <div class="checkout-main">
            <div class="panel checkout-section">
              <div class="section-icon-header">
                <span class="section-icon">ğŸ›’</span>
                <h2>Your Items</h2>
              </div>
              <div id="ckItems"></div>
            </div>

            <div class="panel checkout-section">
              <div class="section-icon-header">
                <span class="section-icon">ğŸ“‹</span>
                <h2>Fulfilment Options</h2>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Mode</label>
                  <select id="ckMode" class="select-with-icon">
                    <option value="buy">ğŸ›ï¸ Buy</option>
                    <option value="rent">ğŸ“– Rent</option>
                    <option value="gift">ğŸ Gift</option>
                  </select>
                </div>
                <div id="rentBlock" class="form-group hidden">
                  <label>Rental period</label>
                  <select id="ckRental">
                    <option value="30">30 days</option>
                    <option value="60">60 days</option>
                  </select>
                </div>
                <div id="giftBlock" class="form-group hidden">
                  <label>Recipient email</label>
                  <input id="ckGiftEmail" type="email" placeholder="friend@example.com" />
                </div>
              </div>
            </div>

            <div id="shippingWrap" class="panel checkout-section">
              <div class="section-icon-header">
                <span class="section-icon">ğŸšš</span>
                <h2>Shipping Details</h2>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Saved addresses</label>
                  <select id="ckSavedAddr"></select>
                </div>
                <div class="form-group">
                  <label>Shipping speed</label>
                  <select id="ckSpeed">
                    <option value="standard">ğŸš¶ Standard (â‚¹30)</option>
                    <option value="express">ğŸš´ Express (â‚¹70)</option>
                    <option value="priority">âœˆï¸ Priority (â‚¹120)</option>
                  </select>
                </div>
              </div>
              <details class="address-details">
                <summary class="small">+ Add new address</summary>
                <div class="grid" style="margin-top:12px" id="ckNewAddr">
                  <div class="form-row">
                    <div class="form-group"><label>Label</label><input data-addr="label" placeholder="Home" /></div>
                    <div class="form-group"><label>Recipient</label><input data-addr="recipient" /></div>
                  </div>
                  <div class="form-group"><label>Street</label><input data-addr="street" /></div>
                  <div class="form-row">
                    <div class="form-group"><label>City</label><input data-addr="city" /></div>
                    <div class="form-group"><label>State</label><input data-addr="state" /></div>
                    <div class="form-group"><label>PIN</label><input data-addr="zip" /></div>
                  </div>
                  <button class="btn" id="btnSaveNewAddr" type="button">Save address</button>
                </div>
              </details>
            </div>

            <div class="panel checkout-section">
              <div class="section-icon-header">
                <span class="section-icon">ğŸ’³</span>
                <h2>Payment Method</h2>
              </div>
              <div class="form-group">
                <label>Choose payment method</label>
                <select id="ckPayMethod">
                  <option value="razorpay">ğŸ’³ Online Payment (Cards, UPI, Wallets)</option>
                  <option value="cod">ğŸ’µ Cash on Delivery (+â‚¹10)</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Right Column: Order Summary Card -->\n          <div class="checkout-sidebar">
            <div class="panel summary-card">
              <div class="section-icon-header">
                <span class="section-icon">ğŸ“Š</span>
                <h2>Order Summary</h2>
              </div>
              <div id="ckSummary"></div>
              <button class="btn primary btn-block" id="btnPay">ğŸ’° Proceed to Payment</button>
              
              <!-- Trust Badges -->\n              <div class="trust-badges">
                <div class="trust-badge">
                  <span>ğŸ”’</span>
                  <small>Secure Payment</small>
                </div>
                <div class="trust-badge">
                  <span>âœ…</span>
                  <small>Safe Checkout</small>
                </div>
                <div class="trust-badge">
                  <span>ğŸ“¦</span>
                  <small>Fast Delivery</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Orders -->
    <!-- Orders Page with Enhanced Layout -->
    <section id="ordersSection" class="hidden">
      <div class="orders-container">
        <div class="panel">
          <div class="page-header">
            <div>
              <h1>ğŸ“¦ Order History</h1>
              <p class="muted">Track all your purchases and shipments</p>
            </div>
          </div>
          <div id="ordersList"></div>
        </div>
      </div>
    </section>

    <!-- Profile Page with Enhanced Layout -->
    <section id="profileSection" class="hidden profile-page">
      <div class="profile-container">
        <div class="panel">
          <div class="page-header">
            <div>
              <h1>ğŸ‘¤ Your Profile</h1>
              <p class="muted">Manage your account settings and preferences</p>
            </div>
          </div>
          <div id="profileView"></div>
        <div id="profileEdit" class="hidden">
          <div class="row">
            <div><label>Name</label><input id="peName" required minlength="2" maxlength="100" /></div>
            <div><label>Phone</label><input id="pePhone" type="tel" pattern="[0-9]{10}" placeholder="10-digit number" title="Please enter a 10-digit phone number" /></div>
          </div>

          <div class="hr"></div>
          <div class="section-icon-header">
            <span class="section-icon">ğŸ“¸</span>
            <h2>Change profile picture</h2>
          </div>
          <div class="row">
            <div>
              <label>Upload image</label>
              <input type="file" id="pePicFile" accept="image/*" />
            </div>
            <div>
              <label>Or image URL</label>
              <input type="url" id="pePicUrl" placeholder="https://..." />
            </div>
          </div>
          <div class="mt-8">
            <div class="avatar-lg" id="pePicPreview"></div>
          </div>

          <div class="pillbar mt-8">
            <button id="peSave" class="btn primary">Save</button>
            <button id="peCancel" class="btn ghost">Cancel</button>
          </div>
        </div>
        <div class="password-section">
          <div class="hr"></div>
          <div class="section-icon-header">
            <span class="section-icon">ğŸ”</span>
            <h2>Change password</h2>
          </div>
          <div class="grid">
            <div class="row">
              <div><label>Current password</label><input type="password" id="cpCurrent" required minlength="6" /></div>
              <div><label>New password</label><input type="password" id="cpNew" required minlength="6" /></div>
            </div>
            <div class="row">
              <div><label>Confirm new password</label><input type="password" id="cpConfirm" required minlength="6" /></div>
              <div class="right"><button id="cpSave" class="btn">Update password</button></div>
            </div>
          </div>
        </div>
      </div>
      <div class="panel">
        <div class="section-icon-header">
          <span class="section-icon">ğŸ“</span>
          <h1>Shipping Addresses</h1>
        </div>
        <h2>Saved Addresses</h2>
        <div id="addrList" class="grid"></div>
        <form id="formAddress" class="grid" style="margin-top:8px">
          <div class="row">
            <div><label>Label</label><input name="label" placeholder="Home / Office" required minlength="2" maxlength="50" /></div>
            <div><label>Recipient</label><input name="recipient" required minlength="2" maxlength="100" /></div>
          </div>
          <div><label>Street</label><input name="street" required minlength="5" maxlength="200" /></div>
          <div class="row3">
            <div><label>City</label><input name="city" required minlength="2" maxlength="100" /></div>
            <div><label>State</label><input name="state" required minlength="2" maxlength="100" /></div>
            <div><label>PIN</label><input name="zip" required pattern="[0-9]{6}" placeholder="6-digit PIN" title="Please enter a 6-digit PIN code" /></div>
          </div>
          <button class="btn primary" type="submit">+ Add address</button>
        </form>
      </div>
      </div>
    </section>
  </main>

  <!-- Cart drawer -->
  <div id="cartDrawer" class="drawer" role="dialog" aria-modal="true">
    <header>
      <div class="pillbar" style="justify-content:space-between;align-items:center">
        <h2 style="margin:0">Your Cart</h2>
        <button id="cartClose" class="btn bad small">Close</button>
      </div>
    </header>
    <div class="body">
      <div id="cartItems"></div>
    </div>
    <div class="foot">
      <div class="row">
        <div><span class="muted">Subtotal</span>
          <div id="cartSubtotal" class="price">â‚¹0.00</div>
        </div>
        <div class="right">
          <button id="cartToCheckout" class="btn primary">Go to checkout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reader Modal -->
  <div id="readerModal" class="modal" role="dialog" aria-modal="true">
    <div class="content panel" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <h2 id="readerTitle">Book Reader</h2>
      <div class="reader-page">
        <div id="readerBody">Loading...</div>
      </div>
      <div class="hr"></div>
      <div class="right"><button id="readerClose" class="btn bad">Close</button></div>
    </div>
  </div>

  <!-- Notification Dropdown Modal -->
  <div id="notificationModal" class="modal">
    <div class="modal-content notification-dropdown">
      <div class="modal-header">
        <h3>Gift Notifications</h3>
        <button id="notificationClose" class="btn ghost small">Ã—</button>
      </div>
      <div id="notificationList" class="notification-list">
        <p class="muted">Loading notifications...</p>
      </div>
    </div>
  </div>

  <div id="toast"></div>

  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCvMzzv81adkAQwBwDXYPUUO1yu3QrKy34",
      authDomain: "booknook-3c7c4.firebaseapp.com",
      projectId: "booknook-3c7c4",
      storageBucket: "booknook-3c7c4.appspot.com",
      messagingSenderId: "877893321467",
      appId: "1:877893321467:web:c5c631d70a7b980850665e",
      measurementId: "G-8NFBLJNF8P"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- AI Chat Assistant Widget -->
  <div id="aiChatWidget" class="ai-chat-widget">
    <button id="aiChatToggle" class="ai-chat-toggle" title="AI Book Assistant">
      ğŸ¤–
    </button>
    <div id="aiChatWindow" class="ai-chat-window hidden">
      <div class="ai-chat-header">
        <div class="ai-chat-title">
          <span class="ai-avatar">ğŸ¤–</span>
          <div>
            <strong>BookNook AI</strong>
            <span class="ai-status">â— Online</span>
          </div>
        </div>
        <button id="aiChatClose" class="ai-chat-close">Ã—</button>
      </div>
      <div id="aiChatMessages" class="ai-chat-messages">
        <div class="ai-message bot">
          <div class="ai-message-content">
            Hi! I'm your AI book assistant. Tell me what kind of book you're looking for!
            <br><br>
            Try: <em>"I want a short thriller under â‚¹300"</em> or <em>"Show me inspiring business books"</em>
          </div>
        </div>
      </div>
      <div class="ai-chat-input">
        <input type="text" id="aiChatInput" placeholder="Describe what you want to read..." />
        <button id="aiChatSend" class="btn primary">Send</button>
      </div>
    </div>
  </div>

  <!-- Book Search by Image Widget -->
  <div id="bookSearchWidget" class="book-search-widget">
    <button id="bookSearchToggle" class="book-search-toggle" title="Find Book by Image">
      ğŸ“¸
    </button>
    <div id="bookSearchWindow" class="book-search-window hidden">
      <div class="book-search-header">
        <div class="book-search-title">
          <span class="search-avatar">ğŸ”</span>
          <div>
            <strong>Book Finder AI</strong>
            <span class="ai-status">â— 4 Agents Ready</span>
          </div>
        </div>
        <button id="bookSearchClose" class="book-search-close">Ã—</button>
      </div>
      <div class="book-search-content">
        <div class="book-search-upload-area" id="bookSearchDropZone">
          <div class="upload-icon">ğŸ“„</div>
          <p><strong>Upload a book page</strong></p>
          <p class="small muted">Drag & drop or click to upload</p>
          <p class="small muted">Our AI will identify which book it's from!</p>
          <input type="file" id="bookSearchInput" accept="image/*" hidden />
        </div>
        <div id="bookSearchPreview" class="book-search-preview hidden">
          <img id="bookSearchImage" src="" alt="Uploaded image" />
          <button id="bookSearchClear" class="btn ghost small">âœ• Clear</button>
        </div>
        <button id="bookSearchSubmit" class="btn primary book-search-submit hidden">
          ğŸ” Find This Book
        </button>
        <div id="bookSearchLoading" class="book-search-loading hidden">
          <div class="agent-progress">
            <div class="agent-step" data-agent="ocr">ğŸ–¼ï¸ OCR Agent extracting text...</div>
            <div class="agent-step" data-agent="identification">ğŸ“š Book Identifier Agent analyzing...</div>
            <div class="agent-step" data-agent="database">ğŸ—„ï¸ Database Agent searching store...</div>
            <div class="agent-step" data-agent="response">ğŸ¤– Response Agent generating result...</div>
          </div>
        </div>
        <div id="bookSearchResult" class="book-search-result hidden">
          <div class="result-card">
            <div class="result-confidence">
              <span id="resultConfidence">94%</span>
              <span class="confidence-label">Confidence</span>
            </div>
            <div class="result-details">
              <h3 id="resultBookName">Book Name</h3>
              <p id="resultPageNumber" class="result-page">Page 47</p>
              <p id="resultMessage" class="result-message"></p>
            </div>
          </div>
          <div class="result-explanation">
            <h4>ğŸ¤– How I found it:</h4>
            <p id="resultExplanation"></p>
          </div>
          <div id="resultAgentInsights" class="agent-insights"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts: API first, then your app logic -->
  <script src="api.js"></script>
  <script src="pdf-reader.js"></script>
  <script src="razorpay-integration.js"></script>
  <script src="app.js"></script>
</body>

</html>